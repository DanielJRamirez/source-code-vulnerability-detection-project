# Detecting Software Vulnerabilities with Deep Learning
### Researched by Laura Wartschinksi
##### https://github.com/LauraWartschinski/VulnerabilityDetection
-----

## Overview
71 Github Python github repositories are analyzed to try to identify 7 common vulnerabilities, listed below. [Word2Vec](https://www.tensorflow.org/tutorials/text/word2vec), commonly used for natural language processing, is used for vectorization of commits from each repository.
#### 7 Vulnerabilities 
* SQL Injection
* Cross-site scripting (XSS)
* Cross-site request forgery (XSRF)
* Path Disclosure
* Open Redirect
* Remote Code Execution (RCE)
* Command Injection

-----

## Methodology Overview
Data is collected using [PyDriller](https://pydriller.readthedocs.io/en/latest/) to mine various Github repositories and create a corpus. The corpus is cleaned, tokenized, and merged with some configurations options available before finally being trained and stored as a word2vec model.

The LSTM models for each vulnerability are trained by scraping Github via the Github API with a focus on natural code bases in Python. That is to say, exclude intentional vulnerabilities (eg proofs of concept) as much as possible and refer to commits in Python.
Once the data is collected and cleaned, it is randomly split into training, validating, and final testing sets at 70%, 15% and 15% splits respectively.

The LSTM model is created for each vulnerability using the word2vec model(s) from before.

![LSTM_Model](https://user-images.githubusercontent.com/90591648/166160705-aed9e3c2-d7a5-4aed-8041-c54dc5802d6d.png)
```
_________________________________________________________________
Model: "sequential_1"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
lstm_1 (LSTM)                (None, 100)               120400    
_________________________________________________________________
dense_1 (Dense)              (None, 1)                 101       
=================================================================
Total params: 120,501
Trainable params: 120,501
Non-trainable params: 0
_________________________________________________________________
```
It's recommended to follow the [VUDENC README](https://github.com/LauraWartschinski/VulnerabilityDetection) for easy replication after setting up an appropriate environment.

-----

## Requirements
#### Note - All scripts ran on a 64-bit Arch Linux machine in an [Anaconda](https://anaconda.org/anaconda/python) environment
I had a hard time getting this to work due to various packages requiring specific versions. Numpy, PyDriller, and Tensorflow seem to be the most strict in their version requirements.
The following should be installed in a Python environment. A requirements.txt is provided in this repository though is the full environment used and not all packages are necessary.

##### These are the most updated versions at time of testing
* Gensim = 3.8.3
* Scikit Learn = 0.24.2
* Pillow = 8.3.2
* keras = 2.3.1
* pydot = 1.4.2
* graphviz = 2.24.3
* nltk = 3.6.7

##### These versions worked best for me, downgraded from more recent versions
* Python = 3.6.11
* PyDriller = 1.18.15
* NumPy = 1.18.5
* Tensorflow = 1.14.0


-----


## Results
**Command Injection**
18814 samples in the final test set.
percentage of vulnerable samples: 12.15%
absolute amount of vulnerable samples in test set: 2287
Accuracy: 0.9776761985755289
Precision: 0.9401225836869401
Recall: 0.8718845649322257
F1 score: 0.904719

**Open Redirect**
12740 samples in the final test set.
percentage of vulnerable samples: 13.27%
absolute amount of vulnerable samples in test set: 1691
Accuracy: 0.9675039246467818
Precision: 0.9095574085952534
Recall: 0.8385570668243643
F1 score: 0.872615

**Path Disclosure**
19680 samples in the final test set.
percentage of vulnerable samples: 11.76%
absolute amount of vulnerable samples in test set: 2315
Accuracy: 0.9730691056910569
Precision: 0.92
Recall: 0.8444924406047516
F1 score: 0.880631

**SQL**
42690 samples in the final test set.
percentage of vulnerable samples: 19.15%
absolute amount of vulnerable samples in test set: 8179
Accuracy: 0.9295385336144296
Precision: 0.8358228341343031
Recall: 0.786770998899621
F1 score: 0.810555


**Remote Code Execution**
14412 samples in the final test set.
percentage of vulnerable samples: 9.04%
absolute amount of vulnerable samples in test set: 1303
Accuracy: 0.9811268387454899
Precision: 0.9598572702943801
Recall: 0.8257866462010744
F1 score: 0.887789

**XSRF**
27434 samples in the final test set.
percentage of vulnerable samples: 13.12%
absolute amount of vulnerable samples in test set: 3600
Accuracy: 0.9723336006415397
Precision: 0.929283771532185
Recall: 0.8541666666666666
F1 score: 0.890143

**XSS**
8277 samples in the final test set.
percentage of vulnerable samples: 8.66%
absolute amount of vulnerable samples in test set: 717
Accuracy: 0.9771656397245378
Precision: 0.919047619047619
Recall: 0.8075313807531381
F1 score: 0.859688

